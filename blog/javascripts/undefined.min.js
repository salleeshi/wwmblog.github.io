(function(a){a.galleryWM={defaults:{link_sels:"a.photos, a.iframes",loadingElement:"",aniDuration:180},isShowing:false,$currentLink:null,loadImg:new Image(),groups:{},gwm_init:function(){a("body").append("<div id='galleryBG'></div><div id='galleryContainer'><div id='galleryWrap'></div><div class='galleryNav left'></div><div class='galleryNav right'></div></div><div id='circle_loading'><div class='circle left'><div class='cl_bg'></div></div><div class='circle right'><div class='cl_bg'></div></div></div>");a("#galleryBG, #galleryWrap").click(function(){a.galleryWM.gwm_hide()});a("#galleryContainer").find(".galleryNav").click(a.galleryWM.gwm_next)},gwm_next:function(){var c=a(this),b=a.galleryWM;idx=b.$currentLink.data("groupIdx");if(c.hasClass("left")){--idx}else{++idx}b.$currentLink=b.groups[b.$currentLink.attr("rel")||"defaultG"][idx];b.gwm_showImage()},gwm_hide:function(){var b=a.galleryWM,c=b.gwm_linkGeo(b.$currentLink);a("#galleryBG").fadeOut();a("#circle_loading").hide();a("#galleryContainer").stop().animate({opacity:0,width:c.width,height:c.height,top:c.top-a(window).scrollTop(),left:c.left-a(window).scrollLeft()},b.defaults.aniDuration,function(){a(this).hide()});isShowing=false},gwm_imageDidLoad:function(){if(!isShowing){return}var b=a.galleryWM.gwm_calcPreferImgSize(this);a("#circle_loading").hide();$container=a("#galleryContainer").stop().animate({opacity:1,width:b.width,height:b.height,top:(a(window).height()-b.height)/2,left:(a(window).width()-b.width)/2},a.galleryWM.defaults.aniDuration).find("img").css("opacity",1).get(0).src=this.src},gwm_linkClicked:function(c){var b=a(this).data("galleryWM");if(b=="image"){c.preventDefault();a.galleryWM.gwm_showImgGallery.call(this);return false}return true},gwm_calcPreferImgSize:function(c){var f=c.width,d=c.height,e=a(window).width()*0.82,b=a(window).height()*0.82;if(b/d<e/f){if(d>b){f=b/d*f;d=b}}else{if(f>e){d=e/f*d;f=e}}return{width:Math.round(f),height:Math.round(d)}},gwm_showImage:function(){var f=a.galleryWM,l=f.$currentLink,m=l.find("img")||l,n=a("#circle_loading"),d=l.attr("href"),c="width:100%;height:100%;",j=l.data("preloadImg"),q={};if(j==undefined){q=f.gwm_calcPreferImgSize({width:m.width(),height:m.height()})}else{if(j.complete){q=f.gwm_calcPreferImgSize(j);n.hide();f.loadImg.onload=null}else{q=f.gwm_calcPreferImgSize({width:m.width(),height:m.height()});c+="opacity:.5;";n.show();f.loadImg.onload=a.galleryWM.gwm_imageDidLoad;f.loadImg.src=d;d=m.attr("src")}}if(d){d='src="'+d+'" '}else{q={width:n.width(),height:n.height()}}var e=a("#galleryWrap"),o=e.find("img");o.animate({opacity:0,width:"+=30%",height:"+=30%",left:"-"+o.width()*0.15+"px",top:"-"+o.height()*0.15+"px"},f.defaults.aniDuration,function(){a(this).remove()});e.prepend("<img "+d+'style="'+c+'">');var b=a("#galleryContainer").stop().animate({opacity:1,width:q.width,height:q.height,top:(a(window).height()-q.height)/2,left:(a(window).width()-q.width)/2},f.defaults.aniDuration).find(".galleryNav"),p=f.$currentLink.attr("rel");if(p!=undefined){var k=f.groups[p||"defaultG"],h=f.$currentLink.data("groupIdx");b.filter(".left").toggle(h>0).end().filter(".right").toggle(h<k.length-1)}else{b.hide()}},gwm_linkGeo:function(b){var c=b.find("img")||b,d=c.offset();return{width:c.width(),height:c.height(),top:d.top,left:d.left}},gwm_showImgGallery:function(){var b=a.galleryWM,d=a(this),c=b.gwm_linkGeo(d);isShowing=true;a("#galleryBG").fadeIn(b.defaults.aniDuration);a("#galleryWrap").empty();a("#galleryContainer").show().css({opacity:0,width:c.width,height:c.height,top:c.top-a(window).scrollTop(),left:c.left-a(window).scrollLeft()});b.$currentLink=d;b.gwm_showImage()}};a(a.galleryWM.gwm_init);a.fn.galleryWM=function(b){var c=a.extend(a.galleryWM.defaults,b);this.on("click",c.link_sels,a.galleryWM.gwm_linkClicked);return this.each(function(){a(c.link_sels,this).each(function(){var i=a(this),h=this.href,d=i.attr("rel");if(h.match(/\.(png|jpg|jpeg|bmp|gif)(.*)?$/)){var k=i.find("img"),e=k.attr("src");if(e!=undefined&&e!=h){var f=new Image();f.src=h;i.data("preloadImg",f)}i.data("galleryWM","image")}else{i.data("galleryWM","iframe")}if(d!=undefined){var j=a.galleryWM.groups[d||"defaultG"];if(!j){j=a.galleryWM.groups[d||"defaultG"]=[]}j.push(i.data("groupIdx",j.length))}})})}})(jQuery);(function(a){a.fn.backToTop=function(c){var b=c|1200;return this.each(function(){var d=a(this);d.click(function(){a("html, body").animate({scrollTop:0},b);d.addClass("hidden")});a(window).scroll(function(){if(a(window).scrollTop()>a(window).height()/2){d.removeClass("hidden")}else{if(!d.hasClass("hidden")){d.addClass("hidden")}}})})}})(jQuery);$(function(){$("#backToTop").backToTop();$(".post, .singlePost").galleryWM()});