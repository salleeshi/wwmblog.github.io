$(function(){function f(){var d=$("body").width(),e=half=d/2,f=window.pageXOffset;for(var g=0;g<3;++g){var h=f<e?-8:0;f<e+half&&(h=8*((f-e)/half-1)),a[g].css("bottom",h+"px"),e+=d}b[0].toggle(f>0),b[1].toggle(f>0),f>=3*d?(b[2].hide(),c[0].focus()):b[2].css("display")=="none"&&(b[2].show(),c[0].blur(),c[1].blur())}function g(a){var b=$('<div class="annotation"><div></div><div></div></div>').appendTo(a.$targetDiv).css("height",0),c=b.children().css("opacity",0),d=$(c[0]),e=$(c[1]),f=null,g=250;a.$annoElems.each(function(){$(this).data("anno",this.title).attr("title","")}).click(function(){d.animate({opacity:0},g);var a=0;if(f!=this){f=this;var c=d;d=e.html($(this).data("anno")).animate({opacity:1},g),e=c,a=d.innerHeight()}else f=null;return b.animate({height:a},g),!1})}function i(a){function c(a){return/[\w\d_\.\-]+@([\w\d_\-]+\.)+[\w\d]{2,4}/.test(a)}function d(a){a.stopPropagation()}a.$msgBox.bind("textchange",function(){a.$notification.html(""),a.hideComplete()}),a.$mailInput.bind("textchange",function(){c($(this).val())?a.$sendBtn.removeAttr("disabled"):a.$sendBtn.attr("disabled","disabled")}).keydown(function(b){var c=b.keyCode|b.which;if(c==13)return a.$sendBtn.click(),!1;if(c==9)return a.$msgBox.focus(),!1;b.stopPropagation()}).trigger("textchange"),a.$msgBox.add(a.$mailInput).keydown(d).keyup(d),a.$sendBtn.click(function(b){var d=a.$msgBox.val(),e=a.$mailInput.val(),f="";if(d==""||d==a.$msgBox.attr("placeholder"))f="你什么都还没写呢=，=";else if(!c(e))f="Email不正确吧~~";else if(a.lastContent==d)f="你刚才就发过了...";else{a.lastContent=d,a.showLoading(),f="正在努力地发送中...",$.ajax({url:a.submitURL,dataType:"jsonp",jsonp:"jsonp",data:{email:e,content:d},success:function(b){b.result=="success"?(a.$notification.html("发送成功，我会尽快回复你的。"),a.showComplete()):g()},error:g,complete:function(){a.hideLoading()}});function g(){a.hideComplete(),a.$notification.html("Oops，出错了。不如直接发邮件给我吧: liangmorr@gmail.com")}}return a.$notification.html(f),!1});var b="placeholder";b in document.createElement("input")||a.$msgBox.add(a.$mailInput).focus(function(){var a=$(this);a.attr(b)!=""&&a.val()==a.attr(b)&&a.val("")}).blur(function(){var a=$(this);a.attr(b)!=""&&a.val()==""&&a.val(a.attr(b))}).blur().end()}var a=[$("#barSkill"),$("#barWork"),$("#barContact")],b=[$("#btnSpace"),$("#btnLeft"),$("#btnRight")],c=[$("#content"),$("#mail")],d={pageLeft:function(){var a=$("body").width(),b=Math.floor(window.pageXOffset/a);window.pageXOffset%a==0&&b>0&&--b,d.scrollTo(b*a)},pageRight:function(){var a=$("body").width(),b=Math.ceil(window.pageXOffset/a);window.pageXOffset%a==0&&b<3&&++b,d.scrollTo(b*a,400,!0)},scrollTo:function(a,b,d){var e=(window.contentWindow||window).document||window.ownerDocument||window,f=$.browser.safari||e.compatMode=="BackCompat"?e.body:e.documentElement,g=typeof a=="number"?a:$(a).offset().left;$(f).stop().animate({scrollLeft:g},b),d||(c[0].blur(),c[1].blur())}};b[0].click(function(){d.scrollTo(0)}),b[1].click(d.pageLeft),b[2].click(d.pageRight),$("#nav a").click(function(a){this.name!=""&&(d.scrollTo(this.name),a.preventDefault())}),$("body").keydown(function(a){var c=0,d=a.keyCode|a.which;if(d==37)c=1;else if(d==39)c=2;else if(d!=32)return!0;b[c].addClass("pressed"),a.preventDefault()}).keyup(function(a){var c=0,d=a.keyCode|a.which;if(d==37)c=1;else if(d==39)c=2;else if(d!=32)return!0;b[c].removeClass("pressed").click(),a.preventDefault()}),$(".container").each(function(a,b){var c=function(a){var b=0;a.wheelDelta&&(b=-a.wheelDelta/4),a.detail&&(b=a.detail*10),window.scrollBy(b),a.preventDefault()};this.addEventListener?(this.addEventListener("DOMMouseScroll",c,!1),this.addEventListener("mousewheel",c,!1)):this.onmousewheel=c}),$("#navButtons a").mousedown(!1).mouseup(!1);for(var e=0;e<3;++e)b[e].css("display","block").hide();$(window).scroll(f).resize(f),f(),g({$targetDiv:$("#introContent"),$annoElems:$("#introContent").children("a")});var h={$msgBox:c[0],$mailInput:c[1],$sendBtn:$("#sendme"),$notification:$("#notification"),submitURL:"http://lmmailserver.appspot.com",showLoading:function(){a[2].css({backgroundPosition:"0 0"}).animate({backgroundPosition:"-96px 0"},500,"linear",h.showLoading)},hideLoading:function(){a[2].stop()},showComplete:function(){$("#stampd").css({left:"2px",top:"87px",width:"147px",height:"91px",opacity:"1"}).animate({left:"7px",top:"92px",width:"137px",height:"81"},100)},hideComplete:function(){$("#stampd").css({opacity:"0"})}};i(h)})