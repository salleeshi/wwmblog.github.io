/*!
 * jCanvaScript JavaScript Library v 1.5.14
 * http://jcscript.com/
 *
 * Copyright 2011, Alexander Savin
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
(function(a,b){function c(a,b,c){var d=M[a].layers[b].objs,e=M[a].layers[b].grdntsnptrns,f=d.length,g=e.length;c=c.slice(1);for(var h=0;h<f;h++)if(d[h].optns.id==c)return d[h];for(h=0;h<g;h++)if(e[h].optns.id==c)return e[h];return!1}function d(a,b,c,d){var e=M[a].layers[b].objs,f=M[a].layers[b].grdntsnptrns,g=e.length,h=f.length;d=d.slice(1);for(var i=0;i<g;i++)e[i]._name==d&&c.elements.push(e[i]);for(i=0;i<h;i++)f[i]._name==d&&c.elements.push(f[i]);return c}function e(a,b,c){var d=M[a].layers[b].objs,e=M[a].layers[b].grdntsnptrns,f=d.length,g=e.length;for(var h=0;h<f;h++)c.elements.push(d[h]);for(h=0;h<g;h++)c.elements.push(e[h]);return c}function f(a){var b=a.optns;a.matrix(o(o(o(b.transformMatrix,b.translateMatrix),b.scaleMatrix),b.rotateMatrix)),h(a)}function g(a,c){for(var d in c)a[d]===b&&(a[d]=c[d]);return a}function h(a){C(a).optns.redraw=1}function i(a){var c=a.timeDiff,d=1;for(var e=0;e<this.animateQueue.length;e++){var f=this.animateQueue[e],g=f.duration,i=f.easing,k=f.step,l=f.onstep,m=i["type"]=="in"||i["type"]=="inOut"&&d<.5,n=i["type"]=="out"||i["type"]=="inOut"&&d>.5;f.step+=c,d=k/g;for(var o in f)if(this[o]!==b&&f[o]){var p=f[o],q=p.to,r=p.from;j(o,this,f),m&&(this[o]=(q-r)*bk[i.fn](d,i)+r),n&&(this[o]=(q-r)*(1-bk[i.fn](1-d,i))+r),l&&l.fn.call(this,l),k>=g&&(this[o]=q,j(o,this,f),f[o]=!1,f.animateKeyCount--,f.animateKeyCount||(f.animateFn&&f.animateFn.apply(this),this.animateQueue.splice(e,1),e--))}}return this.animateQueue.length?h(this):this.optns.animated=!1,this}function j(a,c,d){var e=c[a],f=d[a].prev;switch(a){case"_rotateAngle":c.rotate(e-f,c._rotateX,c._rotateY);break;case"_translateX":c.translate(e-f,0);break;case"_translateY":c.translate(0,e-f);break;case"_translateToX":c.translateTo(e,b);break;case"_translateToY":c.translateTo(b,e);break;case"_scaleX":f||(f=1),c.scale(e/f,1);break;case"_scaleY":f||(f=1),c.scale(1,e/f);break;default:return}d[a].prev=e}function k(b,c,d){b=b||a.event,d[c].event=b,d[c].code=b.charCode||b.keyCode,d[c].val=!0,d.redraw=1}function l(b,c,d){if(!d[c].val)return;b=b||a.event;var e={pageX:b.pageX||b.clientX,pageY:b.pageY||b.clientY};d[c].event=b,d[c].x=e.pageX-d.x,d[c].y=e.pageY-d.y,d.redraw=1}function m(a,c){a===b?this["on"+c]():this["on"+c]=a;if(c=="mouseover"||c=="mouseout")c="mousemove";return C(this).optns[c].val=!0,this}function n(a,c){return a===b?this[c]():this[c]=a,this}function o(a,b){return[[a[0][0]*b[0][0]+a[0][1]*b[1][0],a[0][0]*b[0][1]+a[0][1]*b[1][1],a[0][0]*b[0][2]+a[0][1]*b[1][2]+a[0][2]],[a[1][0]*b[0][0]+a[1][1]*b[1][0],a[1][0]*b[0][1]+a[1][1]*b[1][1],a[1][0]*b[0][2]+a[1][1]*b[1][2]+a[1][2]]]}function p(a,b,c){return{x:a*c[0][0]+b*c[0][1]+c[0][2],y:a*c[1][0]+b*c[1][1]+c[1][2]}}function q(a,b,c){return{x:(a*c[1][1]-b*c[0][1]+c[0][1]*c[1][2]-c[1][1]*c[0][2])/(c[0][0]*c[1][1]-c[1][0]*c[0][1]),y:(-a*c[1][0]+b*c[0][0]-c[0][0]*c[1][2]+c[1][0]*c[0][2])/(c[0][0]*c[1][1]-c[1][0]*c[0][1])}}function r(a,b,c){if(c=="poor")return b;var d={x:b.x,y:b.y},e={x:b.x+b.width,y:b.y+b.height},f=o(a.matrix(),B(a).matrix()),g=p(d.x,d.y,f),h=p(e.x,d.y,f),i=p(d.x,e.y,f),j=p(e.x,e.y,f),k=[[g.x,g.y],[h.x,h.y],[i.x,i.y],[j.x,j.y]];if(c=="coords")return k;var l,m,n=l=g.x,q=m=g.y;for(var r=0;r<4;r++)n<k[r][0]&&(n=k[r][0]),q<k[r][1]&&(q=k[r][1]),l>k[r][0]&&(l=k[r][0]),m>k[r][1]&&(m=k[r][1]);return{x:l,y:m,width:n-l,height:q-m}}function s(a,b,c){return c=="poor"?b:p(b.x,b.y,o(a.matrix(),B(a).matrix()))}function t(a){var c={color:{val:a,notColor:b},r:0,g:0,b:0,a:1};if(a.id!==b)return c.color.notColor={level:a._level,canvas:a.optns.canvas.number,layer:a.optns.layer.number},c;if(a.r!==b)return c=g(a,{r:0,g:0,b:0,a:1}),c.color={val:"rgba("+c.r+","+c.g+","+c.b+","+c.a+")",notColor:b},c;if(a.charAt(0)=="#")if(a.length>4)c.r=parseInt(a.substr(1,2),16),c.g=parseInt(a.substr(3,2),16),c.b=parseInt(a.substr(5,2),16);else{var d=a.charAt(1),e=a.charAt(2),f=a.charAt(3);c.r=parseInt(d+d,16),c.g=parseInt(e+e,16),c.b=parseInt(f+f,16)}else{var h=a.split(",");if(h.length==4){var i=h[0].split("("),j=h[3].split(")");c.r=parseInt(i[1]),c.g=parseInt(h[1]),c.b=parseInt(h[2]),c.a=parseFloat(j[0])}if(h.length==3){i=h[0].split("(");var k=h[2].split(")");c.r=parseInt(i[1]),c.g=parseInt(h[1]),c.b=parseInt(k[0])}}return c.color.notColor=b,c}function u(a){return a.getBoundingClientRect?w(a):v(a)}function v(a){var b=0,c=0;while(a)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}}function w(b){var c=b.getBoundingClientRect(),d=document.body||{},e=document.documentElement,f=a.pageYOffset||e.scrollTop||d.scrollTop,g=a.pageXOffset||e.scrollLeft||d.scrollLeft,h=e.clientTop||d.clientTop||0,i=e.clientLeft||d.clientLeft||0,j=c.top+f-h,k=c.left+g-i;return{top:bb(j),left:bb(k)}}function x(a,b){A(a,b),y(a,b)}function y(a,b){if(!a.optns.focused)return;b.keyDown.val!=0&&typeof a.onkeydown=="function"&&a.onkeydown(b.keyDown),b.keyUp.val!=0&&typeof a.onkeyup=="function"&&a.onkeyup(b.keyUp),b.keyPress.val!=0&&typeof a.onkeypress=="function"&&a.onkeypress(b.keyPress)}function z(a,c,d){var e={},f=C(a),g=f.optns.ctx,h=f.layers[a.optns.layer.number];e.x=c,e.y=d,bi&&(e=q(c,d,h.matrix()),e=q(e.x,e.y,a.matrix()));if(g.isPointInPath===b||a._img!==b||a._imgData!==b||a._proto=="text"){var i=a.getRect("poor");e=q(c,d,o(a.matrix(),h.matrix()));if(i.x<=e.x&&i.y<=e.y&&i.x+i.width>=e.x&&i.y+i.height>=e.y)return e}else if(g.isPointInPath(e.x,e.y))return e;return!1}function A(a,b){var c=!1,d=b.mousemove,e=b.mousedown,f=b.mouseup,g=b.click,h=b.dblclick,i=d.x||e.x||f.x||h.x||g.x,j=d.y||e.y||f.y||h.y||g.y;i!=0&&(c=z(a,i,j)),c&&(d.x!=0&&(d.object=a),e.x!=0&&(e.objects[e.objects.length]=a),g.x!=0&&(g.objects[g.objects.length]=a),h.x!=0&&(h.objects[h.objects.length]=a),f.x!=0&&(f.objects[f.objects.length]=a),b.point=c)}function B(a){return C(a).layers[a.optns.layer.number]}function C(a){return M[a.optns.canvas.number]}function D(a,c,d){h(c);var e=c.optns.canvas,f=c.optns.layer;if(a===b)return f.id;if(f.id==a)return c;var g={i:e.number,j:f.number};f.id=a;var i=bj.layer(a),j={i:i.optns.canvas.number,j:i.optns.number},k=M[g.i].layers[g.j][d],l=M[j.i].layers[j.j][d];return k.splice(c.optns.number,1),c._level=c.optns.number=l.length,l[c._level]=c,f.number=j.j,e.number=j.i,e.id=i.optns.canvas.id,h(c),c}function E(a,c){for(var d in c)switch(typeof c[d]){case"function":if(d.substr(0,2)=="on")break;a[d]===b&&(a[d]=c[d]);break;case"object":if(d=="optns"||d=="animateQueue")break;if(d=="objs"||d=="grdntsnptrns"){for(var e in c[d])c[d].hasOwnProperty(e)&&c[d][e].clone().layer(a.optns.id);break}if(!c[d]||d==="ctx")continue;a[d]=typeof c[d].pop=="function"?[]:{},E(a[d],c[d]);break;default:if(d=="_level")break;a[d]=c[d]}}function F(a,c,d){h(c);var e=c.optns.canvas,f=c.optns.layer;if(a===b)return M[e.number].optns.id;if(M[e.number].optns.id==a)return c;var g={i:e.number,j:f.number};bj.canvas(a);for(var i=0;i<M.length;i++){var j=M[i];if(j.optns.id==a){var k=M[g.i].layers[g.j][d],l=j.layers[0][d];k.splice(c.optns.number,1),G(k),c._level=c.optns.number=l.length,l[c._level]=c,f.number=0,e.number=i,e.id=j.optns.id,f.id=j.layers[0].optns.id}}return h(c),c}function G(a){for(var b=0;b<a.length;b++)a[b].optns.number=b}function H(a,b,c,d,e){var f=a.length,g,h,i;for(var j=0;j<f;j++)g=a[j].optns,h=g.canvas,i=g.layer,h.id=d,h.number=e,i.id=b,i.number=c}function I(a){return a.sort(function(a,b){return a._level>b._level?1:a._level<b._level?-1:0}),G(a),a.length}function J(a){var b;do{b=!1;for(var c=0;c<a.length;c++)a[c].optns.deleted&&(a.splice(c,1),b=!0)}while(b);return G(a),a.length}function K(a){var b=new bm.layer;return b.base(a)}function L(){var a=new bm.group;return a.base()}var M=[],N=Math,O=N.PI,P=O*2,Q=0,R=0,S=!1,T=!1,U=/[A-z]+?/,V=/\d.\w\w/,W=a.navigator.userAgent.match(/Firefox\/\w+\.\w+/i),X=180/O,Y=N.max,Z=N.min,$=N.cos,_=N.sin,ba=N.floor,bb=N.round,bc=N.abs,bd=N.pow,be=N.sqrt,bf=1e3/60,bg=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a,b){return setTimeout(a,bf)}}(),bh=function(){return a.cancelAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||clearTimeout}();if(W!=""&&W!==null)var bi=parseInt(W[0].split(/[ \/\.]/i)[1])<7;var bj=function(a,f){if(a===b)return this;typeof a=="object"&&(f=a,a=b);var g=-1,h=-1,i=M.length,j=L(),k,l,m,n,o,p,q;if(f===b){if(a.charAt(0)=="#")for(k=0;k<i;k++){q=M[k].layers.length;for(l=0;l<q;l++){p=c(k,l,a);if(p)return p}}if(a.charAt(0)==".")for(k=0;k<i;k++){q=M[k].layers.length;for(l=0;l<q;l++)j=d(k,l,j,a)}}else{if(f.canvas!==b)for(k=0;k<i;k++)if(M[k].optns.id==f.canvas){g=k,m=M[k];break}if(f.layer!==b)if(g!=-1){q=m.layers.length;for(k=0;k<q;k++)if(m.layers[k].optns.id==f.layer){h=k,n=m.layers[k];break}}else for(k=0;k<i;k++){o=M[k].layers,q=o.length;for(l=0;l<q;l++)if(o[l].optns.id==f.layer){g=k,h=l,m=M[k],n=m.layers[l];break}if(n>-1)break}if(h<0&&g<0)return L();if(h<0){o=m.layers,q=o.length;if(a===b)for(l=0;l<q;l++)j=e(g,l,j);else if(a.charAt(0)=="#")for(l=0;l<q;l++){p=c(g,l,a);if(p)return p}else if(a.charAt(0)==".")for(l=0;l<q;l++)j=d(g,l,j,a)}else{a===b&&(j=e(g,h,j));if(a.charAt(0)=="#")return c(g,h,a);a.charAt(0)=="."&&(j=d(g,h,j,a))}}if(f!==b)if(f.attrs!==b||f.fns!==b)return j.find(f);return j.elements.length?j:L()},bk={linear:function(a,b){return a},exp:function(a,b){var c=b.n||2;return bd(a,c)},circ:function(a,b){return 1-be(1-a*a)},sine:function(a,b){return 1-_((1-a)*O/2)},back:function(a,b){var c=b.n||2,d=b.x||1.5;return bd(a,c)*((d+1)*a-d)},elastic:function(a,b){var c=b.n||2,d=b.m||20,e=b.k||3,f=b.x||1.5;return bd(c,10*(a-1))*$(d*a*O*f/e)},bounce:function(a,b){var c=b.n||4,d=b.b||.25,e=[1];for(var f=1;f<c;f++)e[f]=e[f-1]+bd(d,f/2);var g=2*e[c-1]-1;for(f=0;f<c;f++)if(g*a>=(f>0?2*e[f-1]-1:0)&&g*a<=2*e[f]-1)return bd(g*(a-(2*e[f]-1-bd(d,f/2))/g),2)+1-bd(d,f);return 1}},bl={color:{fn:function(a,b,c,d){var e,f,g;c=c[d];for(f=0;f<a;f++)for(g=0;g<b;g++)e=this.getPixel(f,g),e[c[0]]=e[c[0]]*2-e[c[1]]-e[c[2]],e[c[1]]=0,e[c[2]]=0,e[c[0]]=e[c[0]]>255?255:e[c[0]],this.setPixel(f,g,e)},matrix:{red:[0,1,2],green:[1,0,2],blue:[2,0,1]}},linear:{fn:function(a,b,c,d){var e=[],f,g,h,i,j,k;c=c[d],j=c.length,k=c[0].length;for(g=0;g<a;g++){e[g]=[];for(h=0;h<b;h++){e[g][h]=[0,0,0,1];for(j=0;j<3;j++)for(k=0;k<3;k++){f=this.getPixel(g-parseInt(j/2),h-parseInt(k/2));for(i=0;i<3;i++)e[g][h][i]+=f[i]*c[j][k]}}}for(g=0;g<a;g++)for(h=0;h<b;h++)this.setPixel(g,h,e[g][h])},matrix:{sharp:[[-0.375,-0.375,-0.375],[-0.375,4,-0.375],[-0.375,-0.375,-0.375]],blur:[[.111,.111,.111],[.111,.111,.111],[.111,.111,.111]]}}},bm={};bm.object=function(){this.getCenter=function(a){var b=this.getRect("poor"),c={x:(b.x*2+b.width)/2,y:(b.y*2+b.height)/2};return s(this,c,a)},this.position=function(){return p(this._x,this._y,o(this.matrix(),B(this).matrix()))},this.buffer=function(a){var c=this.optns.buffer;if(a===b)return c.val?c.cnv:!1;if(c.val===a)return this;if(a){var d=c.cnv=document.createElement("canvas"),e=c.ctx=d.getContext("2d"),f=c.rect=this.getRect(),g=this.transform();d.setAttribute("width",f.width),d.setAttribute("height",f.height),c.x=this._x,c.y=this._y,c.dx=this._transformdx,c.dy=this._transformdy,this._x=this._y=0,this.transform(1,0,0,1,-f.x+c.dx,-f.y+c.dy,!0),this.setOptns(e),E(c.optns={},C(this).optns),c.optns.ctx=e,this.draw(c.optns),this._x=c.x,this._y=c.y,this.transform(g[0][0],g[1][0],g[0][1],g[1][1],f.x,f.y,!0),c.val=!0}else this.translate(-c.rect.x+c.dx,-c.rect.y+c.dy),this.optns.buffer={val:!1};return this},this.clone=function(a){var c=new bm[this._proto];return bm[this._proto].prototype.base.call(c),E(c,this),c.layer(B(this).optns.id),E(c.optns.transformMatrix,this.optns.transformMatrix),E(c.optns.translateMatrix,this.optns.translateMatrix),E(c.optns.scaleMatrix,this.optns.scaleMatrix),E(c.optns.rotateMatrix,this.optns.rotateMatrix),a===b?c:c.animate(a)},this.shadow=function(a){for(var b in a)switch(b){case"x":this._shadowX=a.x;break;case"y":this._shadowY=a.y;break;case"blur":this._shadowBlur=a.blur;break;case"color":var c=t(a.color);this._shadowColor=a.color.val,this._shadowColorR=c.r,this._shadowColorG=c.g,this._shadowColorB=c.b,this._shadowColorA=c.a}return h(this),this},this.setOptns=function(a){a.globalAlpha=this._opacity,a.shadowOffsetX=this._shadowX,a.shadowOffsetY=this._shadowY,a.shadowBlur=this._shadowBlur,a.globalCompositeOperation=this._composite;var b=parseInt(this._shadowColorR),c=parseInt(this._shadowColorG),d=parseInt(this._shadowColorB),e=parseInt(this._shadowColorA*100)/100;return this._shadowColorRPrev!==b||this._shadowColorGPrev!==c||this._shadowColorBPrev!==d||this._shadowColorAPrev!==e?(a.shadowColor=this._shadowColor="rgba("+b+", "+c+", "+d+", "+e+")",this._shadowColorRPrev=b,this._shadowColorGPrev=c,this._shadowColorBPrev=d,this._shadowColorAPrev=e):a.shadowColor=this._shadowColor,a.transform(this._transform11,this._transform12,this._transform21,this._transform22,this._transformdx,this._transformdy),this},this.up=function(a){a===b&&(a=1);if(a=="top")this.level(a);else{var c=B(this).objs[this.optns.number+a];c!==b&&(a=c._level+1-this._level),this.level(this._level+a)}return this},this.down=function(a){a==b&&(a=1);if(a=="bottom")this.level(a);else{var c=B(this).objs[this.optns.number-a];c!==b&&(a=this._level-(c._level-1)),this.level(this._level-a)}return this},this.level=function(a){if(a==b)return this._level;var c=B(this);return a=="bottom"&&(this.optns.number==0?a=this._level:a=c.objs[0]._level-1),a=="top"&&(this.optns.number==c.objs.length?a=this._level:a=c.objs[c.objs.length-1]._level+1),this._level=a,c.optns.anyObjLevelChanged=!0,h(this),this},this.del=function(){this.optns.deleted=!0,B(this).optns.anyObjDeleted=!0,h(this)},this.focus=function(a){return a===b?(this.optns.focused=!0,typeof this.onfocus=="function"&&this.onfocus()):this.onfocus=a,this},this.blur=function(a){return a===b?(this.optns.focused=!1,typeof this.onblur=="function"&&this.onblur()):this.onblur=a,this},this.click=function(a){return m.call(this,a,"click")},this.dblclick=function(a){return m.call(this,a,"dblclick")},this.keypress=function(a){return n.call(this,a,"onkeypress")},this.keydown=function(a){return n.call(this,a,"onkeydown")},this.keyup=function(a){return n.call(this,a,"onkeyup")},this.mousedown=function(a){return m.call(this,a,"mousedown")},this.mouseup=function(a){return m.call(this,a,"mouseup")},this.mousemove=function(a){return m.call(this,a,"mousemove")},this.mouseover=function(a){return m.call(this,a,"mouseover")},this.mouseout=function(a){return m.call(this,a,"mouseout")},this.attr=function(a,c){if(typeof a=="object")var d=a;else{if(c===b)return this["_"+a];d={},d[a]=c}return this.animate(d)},this.queue=function(){var a=this.animateQueue.length,c,d,e,f=0,g=0,h,i=arguments;for(d=0;d<i.length;d++)if(typeof i[d]=="function"){i[d].apply(this),i[d]=!1,d++;if(this.animateQueue.length>a){for(e=a;e<this.animateQueue.length;e++){c=this.animateQueue[e];if(c.duration!==b){c.duration>f&&(f=c.duration,g=e);break}}if(f){c=this.animateQueue[g],c.animateFn?(h=c.animateFn,c.animateFn=function(){h.apply(this),this.queue.apply(this,i)}):c.animateFn=function(){this.queue.apply(this,i)};break}}}},this.stop=function(a,c){this.optns.animated=!1,c===b&&(c=!1),a===b&&(a=!1);for(var d=0;d<this.animateQueue.length;d++){var e=this.animateQueue[d];c&&e.animateFn.call(this);if(a)for(var f in e)e[f].from!==b&&(this[f]=e[f].to,j(f,this,e))}return this.animateQueue=[],this},this.animate=function(a,c,d,e,f){c===b?c=1:(typeof c=="function"&&(f=c,c=1),typeof c=="object"&&(d=c,c=1)),d===b?d={fn:"linear",type:"in"}:(typeof d=="function"&&(f=d,d={fn:"linear",type:"in"}),d.type===b&&(d.type="in")),e===b?e=!1:typeof e=="function"&&(f=e,e=!1),a.scale!==b&&(this._scaleX=this._scaleY=1,typeof a.scale!="object"?a.scaleX=a.scaleY=a.scale:(a.scaleX=a.scale.x||1,a.scaleY=a.scale.y||1)),a.translate!==b&&(this._translateX=this._translateY=0,typeof a.translate!="object"?a.translateX=a.translateY=a.translate:(a.translateX=a.translate.x||0,a.translateY=a.translate.y||0),a.translate=b);if(a.translateTo!==b){var g=this.position();this._translateToX=g.x,this._translateToY=g.y,typeof a.translateTo!="object"?a.translateToX=a.translateToY=a.translateTo:(a.translateToX=a.translateTo.x||0,a.translateToY=a.translateTo.y||0),a.translateTo=b}a.rotate!==b&&(a.rotateAngle=a.rotate.angle,this._rotateAngle=0,this._rotateX=a.rotate.x||0,this._rotateY=a.rotate.y||0,a.rotate=b);if(a.color!==b){var i=t(a.color);i.color.notColor?this.optns.color.notColor=i.color.notColor:(a.colorR=i.r,a.colorG=i.g,a.colorB=i.b,a.alpha=i.a),a.color=b}a.shadowColor!==b&&(i=t(a.shadowColor),a.shadowColorR=i.r,a.shadowColorG=i.g,a.shadowColorB=i.b,a.shadowColorA=i.a,a.shadowColor=b);if(c>1){var j=this.animateQueue[this.animateQueue.length]={animateKeyCount:0};j.animateFn=f||!1,this.optns.animated=!0,j.duration=c,j.step=0,j.easing=d,j.onstep=e}for(var k in a)if(this["_"+k]!==b&&a[k]!==b){var l=a[k],m="_"+k;l!=this[m]&&(l.charAt&&(k=="string"?this._string=l:l.charAt(1)=="="?l=this[m]+parseInt(l.charAt(0)+"1")*parseInt(l.substr(2)):U.test(l)?this[m]=l:l=parseInt(l)),c==1?this[m]=l:(j[m]={from:this[m],to:l,prev:0},j.animateKeyCount++))}return c==1&&(a.rotateAngle&&this.rotate(this._rotateAngle,this._rotateX,this._rotateY),(a.translateX||a.translateY)&&this.translate(this._translateX,this._translateY),(a.translateToX||a.translateToY)&&this.translate(this._translateToX,this._translateToY),(a.scaleX||a.scaleY)&&this.scale(this._scaleX,this._scaleY)),h(this),this},this.matrix=function(a){return a===b?[[this._transform11,this._transform21,this._transformdx],[this._transform12,this._transform22,this._transformdy]]:(this._transform11=a[0][0],this._transform21=a[0][1],this._transform12=a[1][0],this._transform22=a[1][1],this._transformdx=a[0][2],this._transformdy=a[1][2],this)},this.translateTo=function(a,c,d,e,f,g){if(d!==b)return this.animate({translateTo:{x:a,y:c}},d,e,f,g);var h=this.position(),i=0,j=0;return a!==b&&(i=a-h.x),c!==b&&(j=c-h.y),this.translate(i,j)},this.translate=function(a,c,d,e,g,h){return d!==b?this.animate({translate:{x:a,y:c}},d,e,g,h):(this.optns.translateMatrix=o(this.optns.translateMatrix,[[1,0,a],[0,1,c]]),f(this),this)},this.scale=function(a,c,d,e,g,h){return d!==b?this.animate({scale:{x:a,y:c}},d,e,g,h):(c===b&&(c=a),this.optns.scaleMatrix=o(this.optns.scaleMatrix,[[a,0,this._x*(1-a)],[0,c,this._y*(1-c)]]),f(this),this)},this.rotate=function(a,c,d,e,g,h,i){if(e!==b)return this.animate({rotate:{angle:a,x:c,y:d}},e,g,h,i);a/=X;var j=$(a),k=_(a),l=0,m=0;if(c!==b){if(c=="center"){var n=this.getCenter("poor");d===b?(c=n.x,d=n.y):(c=n.x+d.x,d=n.y+d.y)}l=-c*(j-1)+d*k,m=-d*(j-1)-c*k}return this.optns.rotateMatrix=o(this.optns.rotateMatrix,[[j,-k,l],[k,j,m]]),f(this),this},this.transform=function(a,c,d,e,g,h,i){if(a===b)return this.matrix();var j=this.optns;return i!==b?(j.transformMatrix=[[a,d,g],[c,e,h]],j.rotateMatrix=[[1,0,0],[0,1,0]],j.scaleMatrix=[[1,0,0],[0,1,0]],j.translateMatrix=[[1,0,0],[0,1,0]]):j.transformMatrix=o(j.transformMatrix,[[a,d,g],[c,e,h]]),f(this),this},this.beforeDraw=function(a){if(!this._visible)return!1;var b=a.ctx;b.save();if(this.optns.clipObject){var c=this.optns.clipObject;c._visible=!0,c.optns.animated&&i.call(c,a),c.setOptns(b),b.beginPath(),c.draw(b),b.clip()}return this.setOptns(b),this.optns.animated&&i.call(this,a),b.beginPath(),!0},this.clip=function(a){return a===b?this.optns.clipObject:(B(this).objs.splice(a.optns.number,1),this.optns.clipObject=a,this)},this.afterDraw=function(a){a.ctx.closePath(),x(this,a),a.ctx.restore(),this.optns.clipObject&&bm.shape.prototype.afterDraw.call(this.optns.clipObject,a)},this.isPointIn=function(a,c,d){var e=C(this).optns,f=e.ctx,g=!1,h=this.optns,i=!1;d!==b&&(a-=e.x,c-=e.y),h.animated&&(g=!0),h.animated=!1;if(h.clipObject){var j=h.clipObject,k=j.optns;k.animated&&(i=!0,k.animated=!1)}this.beforeDraw(e),this.draw(f);var l=z(this,a,c);return f.closePath(),f.restore(),h.animated=g,i&&(k.animated=i),l?!0:!1},this.layer=function(a){return D(a,this,"objs")},this.canvas=function(a){return F(a,this,"objs")},this.draggable=function(a,c,d){if(c===b&&typeof a=="object"&&a.optns===b){c=a.params,d=a.drag;var e=a.start,f=a.stop,g=a.disabled;a=a.object}var h=this,i=this.optns.drag;typeof c=="function"&&(d=c,c=b),typeof a=="function"&&(d=a,a=b),i.shiftX=0,i.shiftY=0,c!==b&&(c.shiftX!==b&&(i.shiftX=c.shiftX,c.shiftX=b),c.shiftY!==b&&(i.shiftY=c.shiftY,c.shiftY=b)),a!==b&&(a.id&&(h=c===b?a.visible(!1):a.animate(c).visible(!1)),a=="clone"&&(h=this.clone(c).visible(!1),i.type="clone")),i.val=!0,i.x=this._x,i.y=this._y,i.dx=this._transformdx,i.dy=this._transformdy,i.object=h,i.params=c,i.drag=d||!1,i.start=e||!1,i.stop=f||!1,i.disabled=g||!1;var j=C(this).optns;return j.mousemove.val=!0,j.mousedown.val=!0,j.mouseup.val=!0,this},this.droppable=function(a){return this.optns.drop.val=!0,a!==b&&(this.optns.drop.fn=a),this},this.name=function(a){return this.attr("name",a)},this.visible=function(a){return this.attr("visible",a)},this.composite=function(a){return this.attr("composite",a)},this.id=function(a){return a===b?this.optns.id:(this.optns.id=a,this)},this.opacity=function(a){return this.attr("opacity",a)},this.fadeIn=function(a,b,c,d){return this.fadeTo(1,a,b,c,d)},this.fadeOut=function(a,b,c,d){return this.fadeTo(0,a,b,c,d)},this.fadeTo=function(a,c,d,e,f){return c===b&&(c=600),this.animate({opacity:a},c,d,e,f)},this.fadeToggle=function(a,b,c,d){return this._opacity?this.fadeOut(a,b,c,d):this.fadeIn(a,b,c,d),this},this.instanceOf=function(a){return a===b?this._proto:this instanceof bm[a]},this.base=function(a,c,d){typeof a=="object"?(a=g(a,{x:0,y:0,service:!1}),d=a.service,c=a.y,a=a.x):d===b&&(d=!1);var e=M[Q];this.optns={animated:!1,clipObject:!1,drop:{val:!1,fn:function(){}},drag:{val:!1},layer:{id:e.optns.id+"Layer0",number:0},canvas:{number:0},focused:!1,buffer:{val:!1},rotateMatrix:[[1,0,0],[0,1,0]],scaleMatrix:[[1,0,0],[0,1,0]],translateMatrix:[[1,0,0],[0,1,0]],transformMatrix:[[1,0,0],[0,1,0]]},this.animateQueue=[],this._x=a,this._y=c;if(d==0&&e!==b&&e.layers[0]!==b){this.optns.layer.number=0,this.optns.canvas.number=Q;var f=B(this),i=f.objs.length;this.optns.number=i,this._level=i?f.objs[i-1]._level+1:0,f.objs[i]=this,this.optns.layer.id=f.optns.id,h(this)}return this},this._visible=!0,this._composite="source-over",this._name="",this._opacity=1,this._shadowX=0,this._shadowY=0,this._shadowBlur=0,this._shadowColor="rgba(0,0,0,0)",this._shadowColorR=0,this._shadowColorG=0,this._shadowColorB=0,this._shadowColorA=0,this._shadowColorRPrev=0,this._shadowColorGPrev=0,this._shadowColorBPrev=0,this._shadowColorAPrev=0,this._translateX=0,this._translateY=0,this._scaleX=1,this._scaleY=1,this._rotateAngle=0,this._rotateX=0,this._rotateY=0,this._transform11=1,this._transform12=0,this._transform21=0,this._transform22=1,this._transformdx=0,this._transformdy=0,this._matrixChanged=!1},bm.object.prototype=new bm.object,bm.shape=function(){this.color=function(a){return a===b?[this._colorR,this._colorG,this._colorB,this._alpha]:this.attr("color",a)},this.lineStyle=function(a){return this.attr(a)},this.setOptns=function(a){bm.shape.prototype.setOptns.call(this,a),a.lineWidth=this._lineWidth,a.lineCap=this._cap,a.lineJoin=this._join,a.miterLimit=this._miterLimit;var c=this.optns.color;if(c.notColor===b){var d=parseInt(this._colorR),e=parseInt(this._colorG),f=parseInt(this._colorB),g=parseInt(this._alpha*100)/100;this._colorRPrev!==d||this._colorGPrev!==e||this._colorBPrev!==f||this._alphaPrev!==g?(c.val=this._color="rgba("+d+", "+e+", "+f+", "+g+")",this._colorRPrev=d,this._colorGPrev=e,this._colorBPrev=f,this._alphaPrev=g):c.val=this._color}else{var h=c.notColor,i=M[h.canvas].layers[h.layer];i.grdntsnptrns[h.level]!==b&&(c.val=i.grdntsnptrns[h.level].val)}this._fill?a.fillStyle=c.val:a.strokeStyle=c.val},this.afterDraw=function(a){this._fill?a.ctx.fill():a.ctx.stroke(),bm.shape.prototype.afterDraw.call(this,a)},this.base=function(a){return a===b&&(a={}),a.color===b?a.color="rgba(0,0,0,1)":!a.color.charAt&&a.color.id===b&&a.color.r===b&&(a.fill=a.color,a.color="rgba(0,0,0,1)"),a=g(a,{color:"rgba(0,0,0,1)",fill:0}),bm.shape.prototype.base.call(this,a),this._fill=a.fill,this.optns.color={val:a.color,notColor:b},this.color(a.color)},this._colorR=0,this._colorG=0,this._colorB=0,this._alpha=0,this._colorRPrev=0,this._colorGPrev=0,this._colorBPrev=0,this._alphaPrev=0,this._color="rgba(0,0,0,0)",this._lineWidth=1,this._cap="butt",this._join="miter",this._miterLimit=1},bm.shape.prototype=new bm.object,bm.lines=function(){this.getCenter=function(a){var b={x:this._x0,y:this._y0};for(var c=1;c<this.shapesCount;c++)b.x+=this["_x"+c],b.y+=this["_y"+c];return b.x=b.x/this.shapesCount,b.y=b.y/this.shapesCount,s(this,b,a)},this.position=function(){return p(this._x0,this._y0,o(this.matrix(),B(this).matrix()))},this.getRect=function(a){var b,c,d=b=this._x0,e=c=this._y0;for(var f=1;f<this.shapesCount;f++)d<this["_x"+f]&&(d=this["_x"+f]),e<this["_y"+f]&&(e=this["_y"+f]),b>this["_x"+f]&&(b=this["_x"+f]),c>this["_y"+f]&&(c=this["_y"+f]);var g={x:b,y:c,width:d-b,height:e-c};return r(this,g,a)},this.addPoint=function(){h(this);var a=this.pointNames;for(var b=0;b<a.length;b++)this[a[b]+this.shapesCount]=arguments[b];return this.shapesCount++,this},this.delPoint=function(a,c,d){h(this);if(c===b){var e=this.points();e.splice(a,1),this.points(e)}else{d=d||0;for(var f=0;f<this.shapesCount;f++)this["_x"+f]<a+d&&this["_x"+f]>a-d&&this["_y"+f]<c+d&&this["_y"+f]<c+d&&(this.delPoint(f),f--)}return this},this.points=function(a){var c=this.pointNames;if(a===b){a=[];for(var d=0;d<this.shapesCount;d++){a[d]=[];for(var e=0;e<c.length;e++)a[d][e]=this[c[e]+d]}return a}h(this);var f=this.shapesCount;this.shapesCount=a.length;for(d=0;d<this.shapesCount;d++)for(e=0;e<c.length;e++)this[c[e]+d]=a[d][e];for(d=this.shapesCount;d<f;d++)for(e=0;e<c.length;e++)this[c[e]+d]=b;return this},this.base=function(a,c,d){return a!==b&&typeof a.pop=="function"&&(a={points:a,color:c,fill:d}),bm.lines.prototype.base.call(this,a),this.shapesCount=0,a!==b&&a.points!==b&&this.points(a.points),this}},bm.lines.prototype=new bm.shape,bm.line=function(){this.draw=function(a){if(this._x0===b)return;a.moveTo(this._x0,this._y0);for(var c=1;c<this.shapesCount;c++)a.lineTo(this["_x"+c],this["_y"+c])},this.base=function(a,b,c){return bm.line.prototype.base.call(this,a,b,c),this},this._proto="line",this.pointNames=["_x","_y"]},bm.line.prototype=new bm.lines,bm.qCurve=function(){this.draw=function(a){if(this._x0===b)return;a.moveTo(this._x0,this._y0);for(var c=1;c<this.shapesCount;c++)a.quadraticCurveTo(this["_cp1x"+c],this["_cp1y"+c],this["_x"+c],this["_y"+c])},this.base=function(a,b,c){return bm.qCurve.prototype.base.call(this,a,b,c),this},this._proto="qCurve",this.pointNames=["_x","_y","_cp1x","_cp1y"]},bm.qCurve.prototype=new bm.lines,bm.bCurve=function(){this.draw=function(a){if(this._x0===b)return;a.moveTo(this._x0,this._y0);for(var c=1;c<this.shapesCount;c++)a.bezierCurveTo(this["_cp1x"+c],this["_cp1y"+c],this["_cp2x"+c],this["_cp2y"+c],this["_x"+c],this["_y"+c])},this.base=function(a,b,c){return bm.bCurve.prototype.base.call(this,a,b,c),this},this._proto="bCurve",this.pointNames=["_x","_y","_cp1x","_cp1y","_cp2x","_cp2y"]},bm.bCurve.prototype=new bm.lines,bm.circle=function(){this.getCenter=function(a){return s(this,{x:this._x,y:this._y},a)},this.getRect=function(a){var b={x:Math.floor(this._x-this._radius),y:Math.floor(this._y-this._radius)};return b.width=b.height=Math.ceil(this._radius)*2,r(this,b,a)},this.draw=function(a){a.arc(this._x,this._y,this._radius,0,P,!0)},this.base=function(a,b,c,d,e){return typeof a!="object"&&(a={x:a,y:b,radius:c,color:d,fill:e}),a=g(a,{radius:0}),bm.circle.prototype.base.call(this,a),this._radius=a.radius,this},this._proto="circle"},bm.circle.prototype=new bm.shape,bm.rect=function(){this.getRect=function(a){return r(this,{x:this._x,y:this._y,width:this._width,height:this._height},a)},this.draw=function(a){a.rect(this._x,this._y,this._width,this._height)},this.base=function(a,b,c,d,e,f){return typeof a!="object"&&(a={x:a,y:b,width:c,height:d,color:e,fill:f}),a=g(a,{width:0,height:0}),bm.rect.prototype.base.call(this,a),this._width=a.width,this._height=a.height,this},this._proto="rect"},bm.rect.prototype=new bm.shape,bm.arc=function(){this.getRect=function(a){var b={x:this._x,y:this._y},c=this._startAngle,d=this._endAngle,e=this._radius,f=ba(_(c/X)*e),g=ba($(c/X)*e),h=ba(_(d/X)*e),i=ba($(d/X)*e),j=g>0&&i>0,k=g<0&&i<0,l=f>0&&h>0,m=f<0&&h<0;return b.width=b.height=e,this._anticlockwise&&c<d||!this._anticlockwise&&c>d?(k||j&&(m||l)||g==0&&i==0?(b.y-=e,b.height+=e):j&&h<0&&f>0?(b.y+=h,b.height+=h):i>0&&h<0&&g<0?(b.y+=Z(h,f),b.height-=Z(h,f)):(m?b.y-=Y(h,f):b.y-=e,b.height+=Y(h,f)),l||m&&(k||j)||f==0&&h==0?(b.x-=e,b.width+=e):h<0&&f>0?(b.x+=Z(i,g),b.width-=Z(i,g)):(k?b.x-=Y(i,g):b.x-=e,b.width+=Y(i,g))):(j=g>=0&&i>=0,l=f>=0&&h>=0,k=g<=0&&i<=0,m=f<=0&&h<=0,m&&j?(b.x+=Z(i,g),b.width-=Z(i,g),b.y+=Z(h,f),b.height+=Y(h,f)):m&&k?(b.x+=Z(i,g),b.width+=Y(i,g),b.y+=Z(h,f),b.height+=Y(h,f)):m?(b.x+=Z(i,g),b.width+=Y(i,g),b.y-=e,b.height+=Y(h,f)):j&&l?(b.x+=Z(i,g),b.width=bc(i-g),b.y+=Z(h,f),b.height-=Z(h,f)):l?(b.x+=Z(i,g),b.width=bc(i)+bc(g),b.y+=Z(h,f),b.height-=Z(h,f)):k?(b.x-=e,b.width+=Y(i,g),b.y-=e,b.height+=Y(h,f)):j&&(b.x-=e,b.width+=Y(i,g),b.y-=e,b.height+=e)),r(this,b,a)},this.draw=function(a){a.arc(this._x,this._y,this._radius,this._startAngle/X,this._endAngle/X,this._anticlockwise)},this.base=function(a,c,d,e,f,h,i,j){return h!==b&&(h.charAt&&(i=h),h?h=!0:h=!1),typeof a!="object"&&(a={x:a,y:c,radius:d,startAngle:e,endAngle:f,anticlockwise:h,color:i,fill:j}),a=g(a,{radius:0,startAngle:0,endAngle:0,anticlockwise:!0}),bm.arc.prototype.base.call(this,a),this._radius=a.radius,this._startAngle=a.startAngle,this._endAngle=a.endAngle,this._anticlockwise=a.anticlockwise,this},this._proto="arc"},bm.arc.prototype=new bm.shape,bm.text=function(){this.font=function(a){return this.attr("font",a)},this._font="10px sans-serif",this.align=function(a){return this.attr("align",a)},this._align="start",this.baseline=function(a){return this.attr("baseline",a)},this._baseline="alphabetic",this.string=function(a){return this.attr("string",a)},this.position=function(){var a={x:this._x,y:this._y},b=C(this).optns.ctx;return a.height=parseInt(this._font.match(V)[0]),a.y-=a.height,b.save(),b.textBaseline=this._baseline,b.font=this._font,b.textAlign=this._align,a.width=b.measureText(this._string).width,b.restore(),r(this,a)},this.getRect=function(a){var b={x:this._x,y:this._y},c=C(this).optns.ctx;return b.height=parseInt(this._font.match(V)[0]),b.y-=b.height,c.save(),c.textBaseline=this._baseline,c.font=this._font,c.textAlign=this._align,b.width=c.measureText(this._string).width,this._align=="center"&&(b.x-=b.width/2),this._align=="right"&&(b.x-=b.width),c.restore(),r(this,b,a)},this.setOptns=function(a){bm.text.prototype.setOptns.call(this,a),a.textBaseline=this._baseline,a.font=this._font,a.textAlign=this._align},this.draw=function(a){this._maxWidth===!1?this._fill?a.fillText(this._string,this._x,this._y):a.strokeText(this._string,this._x,this._y):this._fill?a.fillText(this._string,this._x,this._y,this._maxWidth):a.strokeText(this._string,this._x,this._y,this._maxWidth)},this.base=function(a,c,d,e,f,h){return e!==b&&e.charAt&&(f!==b&&(h=f),f=e,e=!1),typeof a!="object"&&(a={string:a,x:c,y:d,maxWidth:e,color:f,fill:h}),a=g(a,{string:"",maxWidth:!1,fill:1}),bm.text.prototype.base.call(this,a),this._string=a.string,this._maxWidth=a.maxWidth,this},this._proto="text"},bm.text.prototype=new bm.shape,bm.grdntsnptrn=function(){this.layer=function(a){return D(a,this,"grdntsnptrns")},this.canvas=function(a){return F(a,this,"grdntsnptrns")};var a=new bm.object;return this.animate=a.animate,this.attr=a.attr,this.id=a.id,this.name=a.name,this.level=a.level,this.base=function(){this.animateQueue=[],this.optns={animated:!1,name:"",layer:{id:M[0].optns.id+"Layer_0",number:0},canvas:{number:0},visible:!0},this.optns.layer.id=M[Q].optns.id+"Layer_0",this.optns.layer.number=0,this.optns.canvas.number=Q;var a=M[Q].layers[0].grdntsnptrns;this._level=a.length,a[this._level]=this,h(this)},this},bm.gradients=function(){this.colorStopsCount=0,this.paramNames=["_pos","_colorR","_colorG","_colorB","_alpha"],this.addColorStop=function(a,b){h(this);var c=t(b),d=this.colorStopsCount;return this["_pos"+d]=a,this["_colorR"+d]=c.r,this["_colorG"+d]=c.g,this["_colorB"+d]=c.b,this["_alpha"+d]=c.a,this.colorStopsCount++,this},this.animate=function(a,b,c,d,e){for(var f in a)if(f.substr(0,5)=="color"){var g=f.substring(5),h=t(a[f]);a["colorR"+g]=h.r,a["colorG"+g]=h.g,a["colorB"+g]=h.b,a["alpha"+g]=h.a}bm.gradients.prototype.animate.call(this,a,b,c,d,e)},this.delColorStop=function(a){h(this);var b=this.colorStops();return b.splice(a,1),b.length>0?this.colorStops(b):this.colorStopsCount=0,this},this.colorStops=function(a){var c=this.paramNames;if(a===b){a=[];for(var d=0;d<this.colorStopsCount;d++){a[d]=[];for(var e=0;e<c.length;e++)a[d][e]=this[c[e]+d]}return a}h(this);var f=this.colorStopsCount,g=a.length;if(a[0].length==2)for(d=0;d<g;d++)this.addColorStop(a[d][0],a[d][1]);else for(d=0;d<g;d++)for(e=0;e<c.length;e++)this[c[e]+d]=a[d][e];for(d=g;d<f;d++)for(e=0;e<c.length;e++)this[c[e]+d]=b;return this.colorStopsCount=g,this},this.base=function(a){return bm.gradients.prototype.base.call(this),a==b?this:this.colorStops(a)}},bm.gradients.prototype=new bm.grdntsnptrn,bm.pattern=function(){this.create=function(a){this.optns.animated&&i.call(this,a),this.val=a.ctx.createPattern(this._img,this._type)},this.base=function(a,b){return a.onload&&(a={image:a,type:b}),a=g(a,{type:"repeat"}),bm.pattern.prototype.base.call(this),this._img=a.image,this._type=a.type,this},this._proto="pattern"},bm.pattern.prototype=new bm.grdntsnptrn,bm.lGradient=function(){this.create=function(a){this.optns.animated&&i.call(this,a),this.val=a.ctx.createLinearGradient(this._x1,this._y1,this._x2,this._y2);for(var b=0;b<this.colorStopsCount;b++)this.val.addColorStop(this["_pos"+b],"rgba("+parseInt(this["_colorR"+b])+","+parseInt(this["_colorG"+b])+","+parseInt(this["_colorB"+b])+","+this["_alpha"+b]+")")},this.base=function(a,b,c,d,e){return typeof a!="object"&&(a={x1:a,y1:b,x2:c,y2:d,colors:e}),a=g(a,{x1:0,y1:0,x2:0,y2:0}),bm.lGradient.prototype.base.call(this,a.colors),this._x1=a.x1,this._y1=a.y1,this._x2=a.x2,this._y2=a.y2,this},this._proto="lGradient"},bm.lGradient.prototype=new bm.gradients,bm.rGradient=function(){this.create=function(a){this.optns.animated&&i.call(this),this.val=a.ctx.createRadialGradient(this._x1,this._y1,this._r1,this._x2,this._y2,this._r2);for(var b=0;b<this.colorStopsCount;b++)this.val.addColorStop(this["_pos"+b],"rgba("+parseInt(this["_colorR"+b])+","+parseInt(this["_colorG"+b])+","+parseInt(this["_colorB"+b])+","+this["_alpha"+b]+")")},this.base=function(a,b,c,d,e,f,h){return typeof a!="object"&&(a={x1:a,y1:b,r1:c,x2:d,y2:e,r2:f,colors:h}),a=g(a,{x1:0,y1:0,r1:0,x2:0,y2:0,r2:0}),bm.rGradient.prototype.base.call(this,a.colors),this._x1=a.x1,this._y1=a.y1,this._r1=a.r1,this._x2=a.x2,this._y2=a.y2,this._r2=a.r2,this},this._proto="rGradient"},bm.rGradient.prototype=new bm.gradients,bm.layer=function(){this.position=function(){var a=this.objs,c,d,e,f=a.length;for(e=0;e<f;e++)d=a[e].position(),c===b&&(c=d),c.x>d.x&&(c.x=d.x),c.y>d.y&&(c.y=d.y);return c},this.getRect=function(a){var c=this.objs,d,e,f,g=c.length;if(c.length==0)return!1;if(a=="coords"){for(f=0;f<g;f++)e=c[f].getRect(a),d===b&&(d=e),d[0][0]>e[0][0]&&(d[0][0]=e[0][0]),d[0][1]>e[0][1]&&(d[0][1]=e[0][1]),d[1][0]<e[1][0]&&(d[1][0]=e[1][0]),d[1][1]>e[1][1]&&(d[1][1]=e[1][1]),d[2][0]>e[2][0]&&(d[2][0]=e[2][0]),d[2][1]<e[2][1]&&(d[2][1]=e[2][1]),d[3][0]<e[3][0]&&(d[3][0]=e[3][0]),d[3][1]<e[3][1]&&(d[3][1]=e[3][1]);return d}for(f=0;f<g;f++)e=c[f].getRect(a),e.right=e.width+e.x,e.bottom=e.height+e.y,d===b&&(d=e),d.x>e.x&&(d.x=e.x),d.y>e.y&&(d.y=e.y),d.right<e.right&&(d.right=e.right),d.bottom<e.bottom&&(d.bottom=e.bottom);return d.width=d.right-d.x,d.height=d.bottom-d.y,d},this.canvas=function(a){if(a===b)return this.idCanvas;if(this.optns.canvas.id==a)return this;var c=-1,d=0,e=M.length;for(var f=0;f<e;f++){var g=M[f].optns.id;g==a&&(c=f),g==this.optns.canvas.id&&(d=f)}c<0&&(c=M.length,bj.canvas(a)),this.optns.canvas.id=a,this.optns.canvas.number=c,M[d].layers.splice(this.optns.number,1);var h=M[c].layers;return this._level=this.optns.number=h.length,h[this._level]=this,H(this.objs,this.optns.id,this._level,a,c),H(this.grdntsnptrns,this.optns.id,this._level,a,c),M[c].optns.redraw=1,this},this.up=function(a){a===b&&(a=1);if(a=="top")this.level(a);else{var c=C(this).layers[this.optns.number+a];c!==b&&(a=c._level+1-this._level),this.level(this._level+a)}return this},this.down=function(a){a==b&&(a=1);if(a=="bottom")this.level(a);else{var c=C(this).layers[this.optns.number-a];c!==b&&(a=this._level-(c._level-1)),this.level(this._level-a)}return this},this.level=function(a){if(a==b)return this._level;var c=C(this),d=c.optns;return a=="bottom"&&(this.optns.number==0?a=this._level:a=c.layers[0]._level-1),a=="top"&&(this.optns.number==c.layers.length-1?a=this._level:a=c.layers[c.layers.length-1]._level+1),this._level=a,d.anyLayerLevelChanged=!0,d.redraw=1,this},this.del=function(){var a=C(this).optns;a.anyLayerDeleted=!0,this.draw=!1,a.redraw=1;return},this.setOptns=function(a){return a.setTransform(1,0,0,1,0,0),bm.layer.prototype.setOptns.call(this,a),this},this.afterDraw=function(a){a.ctx.closePath(),a.ctx.restore(),this.optns.clipObject&&bm.layer.prototype.afterDraw.call(this.optns.clipObject,a)},this.clone=function(a,c){var d=bj.layer(a);return E(d,this),E(d.optns.transformMatrix,this.optns.transformMatrix),E(d.optns.translateMatrix,this.optns.translateMatrix),E(d.optns.scaleMatrix,this.optns.scaleMatrix),E(d.optns.rotateMatrix,this.optns.rotateMatrix),d.canvas(C(this).optns.id),c===b?d:d.animate(c)},this.isPointIn=function(a,b,c){var d=this.objs,e;for(e=0;e<d.length;e++)if(d[e].isPointIn(a,b,c))return!0;return!1},this.opacity=function(a){var b=this.objs;for(var c=0;c<b.length;c++)b[c].attr("opacity",a);return this},this.fadeTo=function(a,c,d,e,f){c===b&&(c=600);var g=this.objs;for(var h=0;h<g.length;h++)g[h].animate({opacity:a},c,d,e,f);return this},this.draw=function(a){var b=this.optns,c=b.buffer,d=a.ctx;if(c.val)return d.drawImage(c.cnv,c.x,c.y),this;for(var e=0;e<this.grdntsnptrns.length;e++)this.grdntsnptrns[e].create(a);b.anyObjLevelChanged&&(I(this.objs),b.anyObjLevelChanged=!1),b.anyObjDeleted&&(J(this.objs),b.anyObjDeleted=!1),d.globalCompositeOperation=b.gCO;for(e=0;e<this.objs.length;e++){var f=this.objs[e];if(typeof f.draw=="function"){this.setOptns(d);if(f.beforeDraw(a)&&typeof f.draw=="function"){var g=f.optns.buffer;g.val?d.drawImage(g.cnv,g.x,g.y):f.draw(d),c.optns?f.afterDraw(c.optns):f.afterDraw(a)}}}return this},this.objects=function(a){var c=L(),d=0;while(this.objs[d]!==b)c.elements[d]=this.objs[d++];return a!==b?c.find(a):c},this.base=function(a){var b=M[Q],c=b.layers,d=b.optns;bm.layer.prototype.base.call(this,0,0,!0);var e=c.length;c[e]=this,this.objs=[],this.grdntsnptrns=[],this._level=e?c[e-1]._level+1:0,this.optns.number=e,this.optns.id=a;var f=this.optns;return f.anyObjDeleted=!1,f.anyObjLevelChanged=!1,f.gCO=d.gCO,f.canvas.id=d.id,f.canvas.number=Q,this},this._proto="layer"},bm.layer.prototype=new bm.object,bm.imageData=function(){this.filter=function(a,b){var c=bl[a];return c.fn.call(this,this._width,this._height,c.matrix,b),this},this.getRect=function(a){var b={x:this._x,y:this._y,width:this._width,height:this._height};return r(this,b,a)},this.setPixel=function(a,c,d){var e,f=(a+c*this._width)*4;return d.r!==b?e=d:d[0]!==b&&(d.charAt?e=t(d):e={r:d[0],g:d[1],b:d[2],a:d[3]}),this._data[f+0]=e.r,this._data[f+1]=e.g,this._data[f+2]=e.b,this._data[f+3]=e.a*255,h(this),this},this.getPixel=function(a,b){var c=(a+b*this._width)*4;return[this._data[c+0],this._data[c+1],this._data[c+2],this._data[c+3]/255]},this._getX=0,this._getY=0,this.getData=function(a,b,c,d){this._getX=a,this._getY=b,this._width=c,this._height=d;var e=C(this).optns.ctx;try{this._imgData=e.getImageData(this._getX,this._getY,this._width,this._height)}catch(f){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),this._imgData=e.getImageData(this._getX,this._getY,this._width,this._height)}return this._data=this._imgData.data,h(this),this},this.putData=function(a,c){return a!==b&&(this._x=a),c!==b&&(this._y=c),this._putData=!0,h(this),this},this.clone=function(){var a=bm.imageData.prototype.clone.call(this);return a._imgData=b,a},this.draw=function(a){if(this._imgData===b){this._imgData=a.createImageData(this._width,this._height);for(var c=0;c<this._width*this._height*4;c++)this._imgData.data[c]=this._data[c];this._data=this._imgData.data}this._putData&&a.putImageData(this._imgData,this._x,this._y)},this.base=function(a,c){bm.imageData.prototype.base.call(this);if(c===b){var d=a;d._width!==b?(a=d._width,c=d._height):(a=g(a,{width:0,height:0}),c=a.height,a=a.width)}this._width=a,this._height=c,this._data=[];for(var e=0;e<this._width;e++)for(var f=0;f<this._height;f++){var h=(e+f*this._width)*4;this._data[h+0]=0,this._data[h+1]=0,this._data[h+2]=0,this._data[h+3]=0}return this},this._putData=!1,this._proto="imageData"},bm.imageData.prototype=new bm.object,bm.image=function(){this.getRect=function(a){var b={x:this._x,y:this._y,width:this._width,height:this._height};return r(this,b,a)},this.draw=function(a){a.drawImage(this._img,this._sx,this._sy,this._swidth,this._sheight,this._x,this._y,this._width,this._height)},this.base=function(a,c,d,e,f,h,i,j,k){if(typeof a!="object"||a.src!==b||a.nodeName!==b)a={image:a,x:c,y:d,width:e,height:f,sx:h,sy:i,swidth:j,sheight:k};return a=g(a,{width:!1,height:!1,sx:0,sy:0,swidth:!1,sheight:!1}),a.width===!1&&(a.width=a.image.width,a.height=a.image.height),a.swidth===!1&&(a.swidth=a.image.width,a.sheight=a.image.height),bm.image.prototype.base.call(this,a),this._img=a.image,this._width=a.width,this._height=a.height,this._sx=a.sx,this._sy=a.sy,this._swidth=a.swidth,this._sheight=a.sheight,this},this._proto="image"},bm.image.prototype=new bm.object,bm.groups=function(){for(var a in bm){if(a=="group"||a=="groups")continue;var c=new bm[a];for(var d in c)typeof c[d]=="function"&&this[d]===b&&function(a,c){a[c]=function(){var a=[],d=[],e=0;while(arguments[e]!==b)d[e]=arguments[e++];for(e=0;e<this.elements.length;e++){var f=this.elements[e];E(a,d),typeof f[c]=="function"&&f[c].apply(f,a)}return this}}(this,d)}this.reverse=function(){var a=this.elements;return this.elements=this.unmatchedElements,this.unmatchedElements=a,this},this.end=function(a){return this.previousGroup===b||a===0?this:(a!==b&&a--,this.previousGroup.end(a))},this.find=function(a){var c=L(),d=a.attrs,e=a.fns||[],f,g,h,i,j,k,l;c.previousGroup=this;for(f=0;f<this.elements.length;f++)c.elements[f]=this.elements[f];if(d!==b)for(g in d)d.hasOwnProperty(g)&&(typeof d[g]!="object"&&(d[g]={val:d[g],rel:"=="}),e[e.length]={fn:"attr",args:[g],val:d[g].val,rel:d[g].rel});if(e.length)for(f=0;f<c.elements.length;f++){h=c.elements[f];for(g=0;g<e.length;g++){j=e[g],l=j.val,i=j.rel,typeof h[j.fn]=="function"?k=h[j.fn].apply(h,j.args):i="del";switch(i){case"!=":k==l&&(i="del");break;case"!==":k===l&&(i="del");break;case"==":k!=l&&(i="del");break;case"===":k!==l&&(i="del");break;case">=":k>=l||(i="del");break;case"<=":k<=l||(i="del");break;case">":k>l||(i="del");break;case"<":k<l||(i="del");break;case"typeof":typeof k!=l&&(i="del")}if(i=="del"){c.unmatchedElements[c.unmatchedElements.length]=h,c.elements.splice(f,1),f--;break}}}return c},this.base=function(){return this.elements=[],this.unmatchedElements=[],this}},bm.group=function(){this._proto="group"},bm.group.prototype=new bm.groups,bj.addFunction=function(a,b,c){return bm[c||"object"].prototype[a]=b,bj},bj.addObject=function(a,c,d,e){bm[a]=function(a){this.draw=bm[a].draw,this.base=bm[a].base,this._proto=a};var f=bm[a];return e===b&&(e="shape"),f.prototype=new bm[e],f.draw=d,f.base=function(a,b,c){f.prototype.base.call(this,b);var d=0;for(var e in b)this["_"+e]=c[d]||b[e],e=="color"&&this.color(c[d]||b[e]),d++;return this},function(a,b){bj[a]=function(){var c=new bm[a](a);return c.base(a,b,arguments)}}(a,c),bj},bj.addAnimateFunction=function(a,b){return bk[a]=b,bj},bj.addImageDataFilter=function(a,c){return bl[a]===b&&(bl[a]={}),c.fn!==b&&(bl[a].fn=c.fn),c.matrix!==b&&c.type===b&&(bl[a].matrix=c.matrix),c.type!==b&&(bl[a].matrix[type]=c.matrix),bj},bj.clear=function(a){return M[0]===b?bj:a===b?(M[0].clear(),bj):(bj.canvas(a).clear(),bj)},bj.pause=function(a){return a===b?(M[0].pause(),bj):(bj.canvas(a).pause(),bj)},bj.start=function(a,b){return bj.canvas(a).start(b),bj},bj.pattern=function(a,b){var c=new bm.pattern;return c.base(a,b)},bj.lGradient=function(a,b,c,d,e){var f=new bm.lGradient;return f.base(a,b,c,d,e)},bj.rGradient=function(a,b,c,d,e,f,g){var h=new bm.rGradient;return h.base(a,b,c,d,e,f,g)},bj.line=function(a,b,c){var d=new bm.line;return d.base(a,b,c)},bj.qCurve=function(a,b,c){var d=new bm.qCurve;return d.base(a,b,c)},bj.bCurve=function(a,b,c){var d=new bm.bCurve;return d.base(a,b,c)},bj.imageData=function(a,b){var c=new bm.imageData;return c.base(a,b)},bj.image=function(a,b,c,d,e,f,g,h,i){var j=new bm.image;return j.base(a,b,c,d,e,f,g,h,i)},bj.circle=function(a,b,c,d,e){var f=new bm.circle;return f.base(a,b,c,d,e)},bj.rect=function(a,b,c,d,e,f){var g=new bm.rect;return g.base(a,b,c,d,e,f)},bj.arc=function(a,b,c,d,e,f,g,h){var i=new bm.arc;return i.base(a,b,c,d,e,f,g,h)},bj.text=function(a,b,c,d,e,f){var g=new bm.text;return g.base(a,b,c,d,e,f)},bj.canvas=function(a){if(a===b)return M[0];var c=M.length;for(var d=0;d<c;d++)if(M[d].optns&&M[d].optns.id==a)return M[d];var e={id:function(a){return a===b?this.optns.id:(this.optns.id=a,this)}};return M[c]=e,Q=c,e.cnv=document.getElementById(a),e.width=function(a){return a===b?this.cnv.width:(this.optns.width=this.cnv.width=a,this.cnv.style.width=a+"px",this.optns.redraw=1,this)},e.height=function(a){return a===b?this.cnv.height:(this.optns.heigth=this.cnv.height=a,this.cnv.style.height=a+"px",this.optns.redraw=1,this)},e.optns={id:a,number:Q,ctx:e.cnv.getContext("2d"),width:e.cnv.offsetWidth||e.cnv.width,height:e.cnv.offsetHeight||e.cnv.height,anyLayerDeleted:!1,anyLayerLevelChanged:!1,keyDown:{val:!1,code:!1},keyUp:{val:!1,code:!1},keyPress:{val:!1,code:!1},mousemove:{val:!1,x:!1,y:!1,object:!1},click:{val:!1,x:!1,y:!1,objects:[]},dblclick:{val:!1,x:!1,y:!1,objects:[]},mouseup:{val:!1,x:!1,y:!1,objects:[]},mousedown:{val:!1,x:!1,y:!1,objects:[]},drag:{object:!1,x:0,y:0},gCO:"source-over",redraw:1},e.toDataURL=function(){return e.cnv.toDataURL.apply(e.cnv,arguments)},e.layers=[],e.interval=0,bj.layer(a+"Layer_0").canvas(a),e.start=function(a){Q=this.optns.number;if(!a)return this.frame();if(this.interval)return this;this.isAnimated=a;var b=u(this.cnv);this.optns.x=b.left+(parseInt(this.cnv.style.borderTopWidth)||0),this.optns.y=b.top+(parseInt(this.cnv.style.borderLeftWidth)||0);var c=M[this.optns.number],d=c.optns;return this.cnv.onclick=function(a){l(a,"click",d)},this.cnv.ondblclick=function(a){l(a,"dblclick",d);var b=d.mousemove.val;d.mousemove.val=!0,setTimeout(function(){d.mousemove.val=b},3e3)},this.cnv.onmousedown=function(a){l(a,"mousedown",d)},this.cnv.onmouseup=function(a){l(a,"mouseup",d)},this.cnv.onkeyup=function(a){k(a,"keyUp",d)},this.cnv.onkeydown=function(a){k(a,"keyDown",d)},this.cnv.onkeypress=function(a){k(a,"keyPress",d)},this.cnv.onmouseout=this.cnv.onmousemove=function(a){l(a,"mousemove",d)},d.timeLast=new Date,this.interval=bg(function(a){c.interval=c.interval||1,c.frame(a)},this.cnv),this},e.pause=function(){return bh(this.interval),this.interval=0,this},e.restart=function(){return this.pause().start(!0)},e.del=function(){bh(this.interval),this.layers=[],M.splice(this.optns.number,1);for(var a=0;a<M.length;a++){var b=M[a],c=b.layers,d=c.length;b.optns.number=a;for(var e=0;e<d;e++){var f=c[e];f.optns.canvas.number=a,H(f.objs,f.optns.id,f.optns.number,b.optns.id,b.optns.number),H(f.grdntsnptrns,f.optns.id,f.optns.number,b.optns.id,b.optns.number)}}return this.cnv.parentNode&&this.cnv.parentNode.removeChild(this.cnv),Q=0,!1},e.clear=function(){return bh(this.interval),this.interval=0,this.layers=[],bj.layer(this.optns.id+"Layer_0").canvas(this.optns.id),this.optns.ctx.clearRect(0,0,this.optns.width,this.optns.height),this.optns.redraw++,this},e.frame=function(d){var e=this.optns,g=this;d=d||new Date,e.timeDiff=d-e.timeLast,e.timeLast=d,this.interval&&(this.interval=bg(function(a){g.frame(a)},g.cnv),this.interval=this.interval||1);if(!e.redraw)return this;e.redraw--,e.ctx.clearRect(0,0,e.width,e.height);if(this.layers.length==0)return this;c=this.layers.length,e.anyLayerLevelChanged&&(c=I(this.layers)),e.anyLayerDeleted&&(c=J(this.layers));if(e.anyLayerLevelChanged||e.anyLayerDeleted){e.anyLayerLevelChanged=e.anyLayerDeleted=!1;for(var h=0;h<c;h++){var i=this.layers[h],j=i.optns;H(i.objs,j.id,j.number,this.optns.id,this.optns.number),H(i.grdntsnptrns,j.id,j.number,a,this.optns.number)}}for(h=0;h<c;h++){var k=this.layers[h];typeof k.draw=="function"&&k.beforeDraw(e)&&typeof k.draw=="function"&&(k.draw(e),k.afterDraw(e))}var l=e.mousemove,m=e.mousedown,n=e.mouseup,o=this.optns.click,p=this.optns.dblclick;if(l.x!=0){if(e.drag.object!=0){var r=e.drag,s=r.object;s.translate(l.x-r.x,l.y-r.y),r.x=l.x,r.y=l.y,r.drag&&r.drag.call(s,{x:l.x,y:l.y})}var t=this.optns.point||{};t.event=l.event;if(l.object!=0){var u=l.object,v=B(u);S===u?(typeof u.onmousemove=="function"&&u.onmousemove(t),v===T?typeof v.onmousemove=="function"&&v.onmousemove(t):(T&&typeof T.onmouseout=="function"&&T.onmouseout(t),typeof v.onmouseover=="function"&&v.onmouseover(t),T=v)):(S&&typeof S.onmouseout=="function"&&S.onmouseout(t),typeof u.onmouseover=="function"&&u.onmouseover(t),S=u)}else S&&(typeof S.onmouseout=="function"&&S.onmouseout(t),S=!1),T&&(typeof T.onmouseout=="function"&&T.onmouseout(t),T=!1);e.mousemove.object=!1}if(m.objects.length){var w=m.objects.length-1;a:for(h=w;h>-1;h--){var x=[m.objects[h],B(m.objects[h])],y;for(var z=0;z<2;z++){y=x[z];if(y.optns.drag.val==1&&y.optns.drag.disabled==0&&h==w){r=e.drag,s=r.object=y.optns.drag.object.visible(!0),r.drag=y.optns.drag.drag,r.init=y;var A=r.init.optns;A.drag.params!==b&&s.animate(A.drag.params),r.x=r.startX=m.x,r.y=r.startY=m.y,s!=r.init&&A.drag.type!="clone"&&(t=q(m.x,m.y,s.matrix()),s.translate(t.x-s._x,t.y-s._y)),s.translate(A.drag.shiftX,A.drag.shiftY),typeof A.drag.start=="function"&&A.drag.start.call(s,{x:m.x,y:m.y})}if(typeof y.onmousedown=="function"&&y.onmousedown({x:m.x,y:m.y,event:m.event})===!1)break a}}m.objects=[]}if(n.objects.length){b:for(h=n.objects.length-1;h>-1;h--){var C=[n.objects[h],B(n.objects[h])],D;r=e.drag;for(z=0;z<2;z++){D=C[z];if(e.drag.init!==b){D.optns.drop.val==1?(r.init==r.object&&r.init.visible(!0),typeof D.optns.drop.fn=="function"&&D.optns.drop.fn.call(D,r.init)):(r.object.visible(!1),r.init.visible(!0),r.init.optns.translateMatrix[0][2]=r.object.optns.translateMatrix[0][2],r.init.optns.translateMatrix[1][2]=r.object.optns.translateMatrix[1][2],f(r.init),r.object!=r.init&&r.object.visible(!1),typeof r.init.optns.drag.stop=="function"&&r.init.optns.drag.stop.call(r.init,{x:n.x,y:n.y}));if(r.x!=r.startX||r.y!==r.startY)o.objects=[]}if(typeof D.onmouseup=="function"&&D.onmouseup({x:n.x,y:n.y,event:n.event})===!1)break b}}this.optns.drag={object:!1,x:0,y:0},n.objects=[]}if(o.objects.length){c:for(h=o.objects.length-1;h>-1;h--){var E=[o.objects[h],B(o.objects[h])];for(z=0;z<2;z++)if(typeof E[z].onclick=="function"&&E[z].onclick({x:o.x,y:o.y,event:o.event})===!1)break c}o.objects=[]}if(p.objects.length){d:for(h=p.objects.length-1;h>-1;h--){var F=[p.objects[h],B(p.objects[h])];for(z=0;z<2;z++)if(typeof F[z].ondblclick=="function"&&F[z].ondblclick({x:p.x,y:p.y,event:p.event})===!1)break d}p.objects=[]}return e.keyUp.val=e.keyDown.val=e.keyPress.val=o.x=p.x=n.x=m.x=l.x=!1,this},e},bj.layer=function(a){if(a===b)return M[0].layers[0];for(var c=0;c<M.length;c++){var d=M[c].layers;for(var e=0;e<d.length;e++)if(d[e].optns.id==a)return d[e]}return K(a)},a.jCanvaScript=a.jc=bj})(window,undefined)